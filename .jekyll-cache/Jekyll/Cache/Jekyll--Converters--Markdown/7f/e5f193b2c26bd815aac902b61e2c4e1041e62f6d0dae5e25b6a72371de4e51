I"‰Ü<h1 id="ì¸ì¦">ì¸ì¦</h1>

<p>ì›¹ì—ì„œ ì¸ì¦ì€ í•„ìˆ˜ì ì´ë‹¤.
ë‚´ê°€ ë‚´ ëˆì„ ì“°ê¸° ìœ„í•´ì„œë„ ì¸ì¦ì„ í•´ì•¼í•˜ê³ , ë‚´ê°€ ë‚œë°!ë¥¼ ì¦ëª…í•˜ê¸° ìœ„í•´ì„œë„ ì¸ì¦ì„ í•´ì•¼í•œë‹¤.</p>

<p>ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì¸ì¦ì„ ìœ„í•œ ì •ë§ ë‹¤ì–‘í•œ ë°©ë²•ì´ ì¡´ì¬í•˜ê³ , ì—¬ëŸ¬ ê¸°ìˆ ì„ ê±°ì³ ì§€ê¸ˆì˜ ë°©ë²•(OAuthì™€ JWTë“±â€¦)ìœ¼ë¡œ ë°œì „í•˜ì˜€ë‹¤.</p>

<p>ê°œë°œí•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ìë¥¼ ì¸ì¦í•˜ê³  ìì‹ ì´ ê³„ì •ì— ëŒ€í•œ ì ‘ê·¼ê³¼, ê²Œì‹œíŒ ì´ìš© ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ì„œ ì¸ì¦ ëª¨ë“ˆì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìƒê²¼ê³ , ì¨ë³´ê³  ì—¬ê¸°ì €ê¸°ì„œ ì‚½ì§ˆí•œ ê²½í—˜ì„ ë¼ì ê±°ë ¤ ë³´ë ¤ê³  í•œë‹¤.</p>

<h2 id="passportjs">Passport.js?</h2>

<p>passport.jsëŠ” Node.jsì—ì„œ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë‹¤.</p>

<p>ê·¸ëŸ¼ê³¼ ë™ì‹œì—, passport.js ë˜í•œ í•˜ë‚˜ì˜ í”„ë ˆì„ì›Œí¬ë¡œì„œ ìƒê°í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
ê°œë°œìê°€ êµ¬ì„±í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜ë“¤ì´ ìˆê³ , ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±í–ˆì„ ë•Œ ì´ ë¯¸ë“¤ì›¨ì–´ëŠ” ì˜ˆì¸¡í–ˆë˜ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•˜ê³  ê·¸ ë°˜í™˜ê°’ì„ ë°”íƒ•ì‚¼ì•„ ë‚´ë¶€ì—ì„œ êµ¬ì„±ë˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p>ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ì§œì—¬ì§„ í‹€ ë‚´ì—ì„œ ì‘ì„±ë˜ì–´ì•¼ í•˜ê³ , ë”ìš±ì´ ê³µì‹ë¬¸ì„œë¥¼ ì˜ ì½ì–´ë´ì•¼ í•  ê²ƒì´ë‹¤.</p>

<p>ê³µì‹ í™ˆí˜ì´ì§€<a href="http://www.passportjs.org/docs/">ë§í¬</a>ë¡œ ê°€ë©´ ë¡œì»¬ ì „ëµ(strategy)ë¿ë§Œ ì•„ë‹ˆë¼, OAuthë¥¼ ì§€ì›í•˜ëŠ” ì—¬ëŸ¬ ì‚¬ì´íŠ¸ë“¤(facebook, google)ì„ ì§€ì›í•œë‹¤. 
ì´ ì¤‘ì—ì„œ ìš°ë¦¬ëŠ” Local Strategyì™€ JWT Strategyì— ëŒ€í•´ì„œ ì¤‘ì ì ìœ¼ë¡œ ì‚´í´ë³¼ ê²ƒì´ë‹¤.</p>

<p>ê¸€ì„ ì“°ëŠ”ë° ì°¸ê³ í•œ ë¬¸ì„œëŠ” ê³µì‹ í™ˆí˜ì´ì§€ ë„í<a href="http://www.passportjs.org/docs/downloads/html/">ë§í¬</a>, Nest.js ê³µì‹ ë„í<a href="https://docs.nestjs.com/security/authentication">ë§í¬</a>ë¥¼ ì°¸ê³ í•˜ì˜€ìŒì„ ë°íŒë‹¤.</p>

<h2 id="localstrategy">LocalStrategy</h2>
<p>ê°€ì¥ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” LocalStrategyëŠ” ì•„ì´ë””/íŒ¨ìŠ¤ì›Œë“œ ì¸ì¦ ë§¤ì»¤ë‹ˆì¦˜ìœ¼ë¡œ, ëŒ€ë¶€ë¶„ì˜ ì‚¬ì´íŠ¸ë“¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¸ì¦ ì „ëµì¼ ê²ƒì´ë‹¤.</p>

<p>ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ì•ì„œ, í•„ìš”í•œ ëª¨ë“ˆë“¤ì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save</span> @nestjs/passport passport passport-local
npm <span class="nb">install</span> <span class="nt">--save-dev</span> @types/passport-local
</code></pre></div></div>

<p>í•„ìš”í•œ ëª¨ë“ˆë“¤ì„ ì„¤ì¹˜í–ˆë‹¤ë©´, ì´ì œ ì¸ì¦ ì „ëµì„ êµ¬ì„±í•˜ê³  ì„œë¹„ìŠ¤ì— ì ìš©í•´ë³´ì.</p>

<h3 id="implementing-localstrategy">Implementing LocalStrategy</h3>
<p>ê¸°ë³¸ì ìœ¼ë¡œ, LocalStrategyëŠ” ì´ì™€ ë¹„ìŠ·í•˜ê²Œ êµ¬ì„±ëœë‹¤</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Strategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">passport-local</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PassportStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/passport</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">UnauthorizedException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./auth.service</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">LocalStrategy</span> <span class="kd">extends</span> <span class="nx">PassportStrategy</span><span class="p">(</span><span class="nx">Strategy</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">authService</span><span class="p">:</span> <span class="nx">AuthService</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">validateUser</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnauthorizedException</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, LocalStrategyëŠ” PssportStrategy(Strategy)ì˜ ë°˜í™˜ê°’ìœ¼ë¡œ ë‚˜ì˜¨ í´ë˜ìŠ¤ë¥¼ ê³„ìŠ¹í•˜ê³  ìˆê³ , ë‚´ë¶€ì ìœ¼ë¡œëŠ” validateë¼ëŠ” í•¨ìˆ˜ê°€ ìˆê³  ì´ í•¨ìˆ˜ëŠ” usernameê³¼ passwordë¼ëŠ” ë§¤ê°œë³€ìˆ˜ë“¤ì„ ê°€ì§„ë‹¤.</p>

<p>ìœ„ ë§¤ê°œë³€ìˆ˜ë“¤ì€ request.bodyì—ì„œ ìë™ìœ¼ë¡œ usernameê³¼ password ê°’ì„ ì°¾ì•„ì™€ ë„£ì–´ì£¼ê¸° ë•Œë¬¸ì—, í”„ë¡ íŠ¸ìª½ì—ì„œ ì•„ì´ë””ë¥¼</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"id"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ê°œë°œë˜ê³  ìˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•´ì¤„ ìˆ˜ ìˆë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// local.strategy.ts</span>
<span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">({</span>
        <span class="c1">// ì—¬ê¸°ì„œ ì˜µì…˜ ì˜¤ë¸Œì íŠ¸ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤!</span>
        <span class="na">usernameField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span>
    <span class="p">});</span>
  <span class="p">}</span>

</code></pre></div></div>

<p>ë³¼ë§Œí¼ ë´¤ìœ¼ë‹ˆ, ìš°ë¦¬ê°€ êµ¬ì„±í•œ ì½”ë“œì—ì„œ ì´ ì „ëµì´ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ë³´ì</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/auth"</span> <span class="na">class=</span><span class="s">"signin-form"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group mt-3"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">required</span> <span class="nt">/&gt;</span>
    	<span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-control-placeholder"</span> <span class="na">for=</span><span class="s">"username"</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">required</span> <span class="nt">/&gt;</span>
    	<span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-control-placeholder"</span> <span class="na">for=</span><span class="s">"password"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
    	<span class="nt">&lt;span</span>
    		<span class="na">toggle=</span><span class="s">"#password-field"</span>
    		<span class="na">class=</span><span class="s">"fa fa-fw fa-eye field-icon toggle-password"</span>
    	<span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"form-control btn btn-primary rounded submit px-3"</span><span class="nt">&gt;</span>
    		Sign In
    	<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>ë¡œê·¸ì¸ í˜ì´ì§€ ì½”ë“œì´ë‹¤.
ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì¸í’‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ê³ , ê° inputì˜ nameì„ usernameê³¼ passwordë¡œ êµ¬ì„±í•´ë†“ì•˜ê³ , postë©”ì†Œë“œë¥¼ í†µí•´ì„œ /auth ë¡œ ë³´ë‚´ì§€ê²Œ ëœë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// auth.controller.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Get</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">Post</span><span class="p">,</span> <span class="nx">Render</span><span class="p">,</span> <span class="nx">UseGuards</span><span class="p">,</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">Res</span><span class="p">,</span> <span class="nx">Redirect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthGuard</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/passport</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../service/auth.service</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">auth</span><span class="dl">"</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthController</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">authService</span><span class="p">:</span> <span class="nx">AuthService</span><span class="p">)</span> <span class="p">{}</span>

    <span class="p">...(</span><span class="nx">ìƒëµ</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">UseGuards</span><span class="p">(</span><span class="nx">AuthGuard</span><span class="p">(</span><span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">))</span>
	<span class="p">@</span><span class="nd">Redirect</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
	<span class="p">@</span><span class="nd">Post</span><span class="p">()</span>
	<span class="k">async</span> <span class="nx">login</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>

		<span class="k">return</span> <span class="dl">"</span><span class="s2">success!</span><span class="dl">"</span><span class="p">;</span> 
	<span class="p">}</span>
    <span class="p">...(</span><span class="nx">ìƒëµ</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ìœ„ì˜ í˜ì´ì§€ì—ì„œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ëª¨ë“ˆì´ë‹¤.
ë‹¤ë¥¸ ì½”ë“œë“¤ì€ ì œì™¸í•˜ê³ , login ë§Œì„ ìœ„í•œ ë¶€ë¶„ì„ ì¶”ë ¸ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// auth.service.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Mapper</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../mapper/mapper</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">queryString</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../common/query</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">executionResult</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">src/dto/user.dto</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthService</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span>
		<span class="k">private</span> <span class="k">readonly</span> <span class="nx">mapper</span><span class="p">:</span> <span class="nx">Mapper</span><span class="p">,</span>
	<span class="p">)</span> <span class="p">{}</span>

    <span class="p">...(</span><span class="nx">ìƒëµ</span><span class="p">)</span>
	<span class="k">async</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">userid</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">userpw</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="na">findOne</span><span class="p">:</span> <span class="nx">executionResult</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">mapper</span><span class="p">(</span>
			<span class="nx">queryString</span><span class="p">.</span><span class="nx">findOne</span><span class="p">,</span>
			<span class="p">[</span><span class="nx">userid</span><span class="p">],</span>
		<span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span>
			<span class="nx">findOne</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
			<span class="nx">findOne</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">]</span> <span class="o">===</span> <span class="nx">userpw</span>
		<span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">findOne</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
    <span class="p">...(</span><span class="nx">ìƒëµ</span><span class="p">)</span>

<span class="p">}</span>

</code></pre></div></div>
<p>ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” AuthService ë¶€ë¶„ì˜ validateë¶€ë¶„ì´ë‹¤. 
useridì™€ userpwë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ê³ , dbì—ì„œ í•´ë‹¹ ë§¤ê°œë³€ìˆ˜ë“¤ë¡œ í•´ë‹¹í•˜ëŠ” ê°’ì´ ìˆëŠ”ì§€ ì°¾ê³  ì‹¤í–‰ ê²°ê³¼ì— ë”°ë¥¸ ê°’ì„ ë¦¬í„´í•´ì¤€ë‹¤.</p>

<p>ìœ„ì˜ ì½”ë“œì—ì„œëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ í‰ë¬¸ìœ¼ë¡œ ë‹¤ë£¨ê³  ìˆì§€ë§Œ, ì‹¤ì œ ëª¨ë“ˆì—ì„œëŠ” bycryptì™€ ê°™ì€ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë‹¨ë°©í–¥ í•´ì‹±í•˜ì—¬ ì €ì¥í•˜ê³  ë¹„êµí• ë•ŒëŠ” ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ í•´ì‹± í›„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ì—¬ì•¼ í•œë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// local.strategy.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Strategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">passport-local</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PassportStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/passport</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">UnauthorizedException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./auth.service</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">LocalStrategy</span> <span class="kd">extends</span> <span class="nx">PassportStrategy</span><span class="p">(</span><span class="nx">Strategy</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">authService</span><span class="p">:</span> <span class="nx">AuthService</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">validateUser</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnauthorizedException</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>ìµœì¢…ì ìœ¼ë¡œ(ì‹¤ì œë¡œëŠ” ê°€ì¥ ë§¨ ì²˜ìŒ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ) ì‚¬ìš©ë˜ëŠ” ì½”ë“œë‹¤.
ì‚¬ìš©ìê°€ ë³´ë‚´ëŠ” ë°ì´í„°ê°€ post ë©”ì†Œë“œë¡œ http://example.com/authë¡œ ë³´ë‚´ì§€ê²Œ ëœë‹¤.
ì´ ë°ì´í„°ëŠ” @UseGuard(AuthGuard(â€œlocalâ€)) ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ì„œ localStrategyë¡œ ê²€ì¦í•˜ê²Œ ëœë‹¤.
AuthServiceì— ì†í•œ validate ë©”ì†Œë“œë¥¼ í†µí•´ì„œ ë°›ì•„ì˜¨ ê°’ì„ ë°”íƒ•ìœ¼ë¡œ ì¸ì¦ ì„±ê³µ ìœ ë¬´ë¥¼ íŒë‹¨í•˜ê³ , ì¸ì¦ ì‹¤íŒ¨ì‹œ UnauthorizedExceptionì„ ë°˜í™˜í•œë‹¤.
ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° userì˜ ê°’ì„ ë°˜í™˜í•˜ê³ , ì´ ê°’ì€ reqì˜ userì— ì €ì¥ëœë‹¤.</p>

<p>ì´ ê°’ìœ¼ë¡œ ë­”ê°€ í•˜ê³  ì‹¶ë‹¤ë©´, ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Post</span><span class="p">()</span>
<span class="k">async</span> <span class="nx">login</span><span class="p">(@</span><span class="nd">Request</span><span class="p">()</span> <span class="nx">req</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
	<span class="k">return</span> <span class="dl">"</span><span class="s2">success!</span><span class="dl">"</span><span class="p">;</span> 
<span class="p">}</span>

</code></pre></div></div>
<p>ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.</p>

<p>ì‚¬ìš©ìê°€ ë³´ë‚´ì£¼ëŠ” ë°ì´í„°ë„ ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•´ì„œ ê²€ì¦í•  ìˆ˜ ìˆê³  ê·¸ ë°ì´í„°ë¥¼ ì‚¬ìš©ê¹Œì§€ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p>

<p>ê·¼ë° ìš°ë¦¬ëŠ” ì¸í„°ë„·ì—ì„œ ë©”ì¼ ì „ì²´ë¥¼ ì½ì–´ì˜¬ë•Œ í•œë²ˆ ë¡œê·¸ì¸í•˜ê³ , ê·¸ ì¤‘ì— í•˜ë‚˜ë¥¼ ì½ì–´ì˜¬ë•Œ ë§ˆë‹¤ ë¡œê·¸ì¸ì„  ë‹¤ì‹œ í•˜ì§€ ì•ŠëŠ”ë‹¤.
ì´ëŸ¬í•œ ì‘ì—…ì´ ê°€ëŠ¥í•œê±´ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ìœ ì§€í•˜ê¸° ë•Œë¬¸ì¸ë°, statelessí•œ httpì˜ í•œê³„ë¥¼ ë„˜ì–´ì„¤ìˆ˜ ìˆëŠ” ë°©ë²•ìœ¼ë¡œ ì–¸ê¸‰ë  ë•Œ í•­ìƒ ë‚˜ì˜¤ëŠ” í‚¤ì›Œë“œë“¤ì¸ ì¿ í‚¤ì™€ ì„¸ì…˜ ê·¸ë¦¬ê³  í† í°ê¹Œì§€ ì•Œì•„ë³´ë„ë¡œê³  í•˜ì.</p>

<h1 id="cookie-session">Cookie, Session</h1>
<p>ê°€ë” ì¿ í‚¤ì™€ ì„¸ì…˜ì— ëŒ€í•´ì„œ ë°˜ëŒ€ë˜ëŠ” ê°œë…ì´ê³ , ì™„ì „íˆ ë™ë–¨ì–´ì§„ ê°œë…ì´ë¼ê³  ì„¤ëª…í•˜ëŠ” ê¸€ë„ ìˆì—ˆëŠ”ë° ì •ë¦¬ë¥¼ ìœ„í•´ ë‹¤ì‹œ ì°¾ì•„ë³´ë‹ˆ ê·¸ëŸ¬í•œ ì˜¤ê°œë…ë“¤ì„ ë§ì´ ì‚¬ë¼ì§„ ê²ƒ ê°™ë‹¤.</p>

<p>ê²°ë¡ ì ìœ¼ë¡œ ì¿ í‚¤ì™€ ì„¸ì…˜ì€ ë‹¤ë¥¸ ê°œë…ì´ê¸°ëŠ” í•˜ì§€ë§Œ, ì™„ì „íˆ ë™ë–¨ì–´ì¡Œë‹¤ê¸° ë³´ë‹¨ ì‚¬ìš©ë˜ëŠ” ì˜ì—­ì´ ê°ê° í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ë¡œ ì°¨ì´ê°€ ìˆê³  ì„œë¡œê°€ ì„œë¡œì—ê²Œ ì—°ê´€ì´ ìˆë‹¤ë¼ê³  ìƒê°í•˜ëŠ”ê²ƒì´ ì¢‹ì§€ ì•Šë‚˜ ì‹¶ë‹¤.</p>

<p>ì„¸ì…˜ì´ë¼ëŠ” ê²ƒì€, ì‚¬ìš©ìê°€ ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í–ˆì„ë•Œ ë¡œê·¸ì¸ì´ ì„±ê³µí•œë‹¤ë©´ ì´ ìœ ì €ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆë„ë¡ ê³ ìœ í•œ IDë¥¼ ìƒì„±í•˜ê³ , ì´ì™€ ì—°ê²°ë˜ëŠ” ì„¸ì…˜ IDë¥¼ ë°œí–‰í•œë‹¤.
ê·¸ ë‹¤ìŒ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ë³´ë‚¼ë•Œ ì´ ì„¸ì…˜ IDë¥¼ í•¨ê»˜ ë³´ë‚´ê³ , ì‚¬ìš©ìëŠ” ì„¸ì…˜ IDë¥¼ ì¿ í‚¤ì— ì €ì¥í•œ í›„ ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ë§ˆë‹¤ ì¿ í‚¤ë¥¼ í—¤ë”ì— ì‹¤ì–´ì„œ ë³´ë‚´ê²Œ ëœë‹¤.
ì´ì œë¶€í„° ì„œë²„ëŠ” ì´ ì¿ í‚¤ê°€ ë§Œë£Œë˜ì§€ ì•ŠëŠ” í•œ(ì„œë²„ì˜ ì„¸ì„  ì €ì¥ì†Œì™€ ì‚¬ìš©ìì˜ í´ë¼ì´ì–¸íŠ¸ ë‘˜ ë‹¤ì—ì„œ), í•´ë‹¹ ì‚¬ìš©ìê°€ ë³´ë‚´ëŠ” ì¸ì¦ì„ ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€ íŒŒì•…ì•Œ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p>

<p>ì´ë ‡ê²Œ ì„¸ì…˜ê³¼ ì¿ í‚¤ëŠ” ë¶„ë¦¬ëœ ê°œë…ì´ ì•„ë‹ˆë¼ ê°™ì´ ì‚¬ìš©í•˜ëŠ” ê°œë…ì¸ ê²ƒì´ë‹¤.</p>

<h1 id="token">Token</h1>
<p>ê·¸ëŸ¼ í† í°ì€ ëŒ€ì²´ ë­ëƒ? ì‹¶ì€ ì‚¬ëŒë“¤ë„ ìˆì„ ê²ƒì´ë‹¤.</p>

<p>ì¼ë‹¨ í† í°ì€ ì‘ë™ë˜ëŠ” ë°©ì‹ì„ ë³´ë©´ ì„¸ì…˜ê³¼ ìœ ì‚¬í•˜ê²Œ ìƒê° í•  ìˆ˜ë„ ìˆë‹¤. ì¸ì¦ì— í•„ìš”í•œ ì •ë³´ë“¤ì´ ì¿ í‚¤ì— ì²¨ë¶€ë˜ì„œ ë³´ë‚´ì§€ê²Œ ë˜ê³ , ì„œë²„ë‹¨ì—ì„œ íŠ¹ì •í•œ ë°©ë²•ìœ¼ë¡œ ì´ë¥¼ ê²€ì¦í•œë‹¤.</p>

<p>í•˜ì§€ë§Œ ê°€ì¥ í° ë¶€ë¶„ì¸ ê²€ì¦í•˜ëŠ” ìª½ì—ì„œ ì°¨ì´ì ì´ ë°œìƒí•˜ê²Œ ëœë‹¤.
ì•ì„œ ë§í–ˆë“¯, ì„¸ì…˜ì€ ì„¸ì„  ì €ì¥ì†Œë¼ëŠ” ê³µê°„ì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•˜ê³ , ì´ ì €ì¥ì†Œì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ì¤€ ì„¸ì…˜ idë¥¼ ëŒ€ì¡°í•´ì„œ í™•ì¸í•˜ëŠ” ë°˜ë©´ì— í† í°ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ í•˜ë©´ ì„œë²„ëŠ” í† í°ì´ ìœ íš¨í•œì§€ í™•ì¸ë§Œ í•˜ê²Œ ëœë‹¤.
httpì˜ statelessí•œ ì„±ê²©ê³¼ ë”ìš± ë“¤ì–´ë§ê³ , ì„œë²„ì¸¡ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ì„œë²„ì¼ìˆ˜ë¡ ë”ìš± íš¨ìœ¨ì´ ì¢‹ì•„ì§„ë‹¤ê³  í•œ ê¸€<a href="https://dev.to/vasilevskialeks/token-vs-session-authentication-56ed">ë§í¬</a>ì—ì„œ ì„¤ëª…í•œë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ í† í°ì€(ëŒ€í‘œê²©ì¸ JWTëŠ”) ëª¨ë“  ê²½ìš°ì—ì„œ ìœ íš¨í•œ ë§ŒëŠ¥ì˜ ìˆ˜ë‹¨ì¸ê°€? ë¼ê³  ë§í•œë‹¤ë©´ ì´ê²ƒë˜í•œ ì•„ë‹ˆë¼ê³  í•  ìˆ˜ ìˆë‹¤.</p>

<p>ìš°ì„  í† í°ì€ í•œë²ˆ íƒˆì·¨ë˜ê²Œ ë˜ë©´ ìœ íš¨ê¸°ê°„ì´ ë§Œë£Œë˜ê¸° ì „ê¹Œì§€ íƒˆì·¨í•œ í•´ì»¤ê°€ ë¬´ì œí•œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë§ŒëŠ¥í‚¤ê°€ ë˜ê³ , ë”ìš± ìœ ì˜í•´ì„œ ê´€ë¦¬í•´ì•¼ í•  í•„ìš”ê°€ ìˆë‹¤.
ë˜ Statelessí•˜ë‹¤ëŠ” ê²ƒì€ ì„œë²„ì—ì„œ ì‚¬ìš©ìê°€ ê°€ì§€ê³  ìˆëŠ” í† í°ê³¼ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šë‹¤ëŠ” ê²ƒì´ê³ , ê¸°ì¡´ ì„¸ì…˜ì˜ ê²½ìš° ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒ í•œë‹¤ë©´ ë‹¨ìˆœí•˜ê²Œ ì„¸ì…˜ ì €ì¥ì†Œì—ì„œ ê·¸ ì„¸ì…˜IDë¥¼ ë‚ ë¦¬ë©´ ëª¨ë“ ê²ƒì´ í•´ê²°ë˜ì§€ë§Œ í† í°ì˜ ê²½ìš° ì´ëŸ° ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , ë§Œë£Œëœ í† í°ì„ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ë§Œë“¤ë˜ê°€, í† í°ì˜ ìƒëª… ì£¼ê¸°ë¥¼ êµ‰ì¥íˆ ì§§ê²Œ(5ë¶„ ì •ë„) ì„¤ì •í•˜ê³  ì‹œê°„ì´ ì§€ë‚˜ë©´ ìƒˆë¡­ê²Œ í† í°ì„ ë§Œë“¤ë˜ê°€, ì„œë²„ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ ì œê±°í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì— í† í° ì‚­ì œë¥¼ ìœ„ì„í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</p>

<p>í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œë“¤ì´ ì•ì˜ ë‘ ë°©ë²•, ìƒëª…ì£¼ê¸°ë¥¼ ì§§ê²Œ í•˜ê±°ë‚˜ ë§Œë£Œëœ í† í°ì„ ì €ì¥í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ êµ¬í˜„ì´ ë˜ì–´ìˆë‹¤.
ì´ëŸ¬í•œ ë°©ë²•ë“¤ì€ ê²°êµ­ JWTì˜ íŠ¹ì§•ì´ì˜€ë˜ Statelessì™€ ì´ë¥¼ í†µí•´ì„œ ë°œìƒí•˜ëŠ” ì¥ì ë“¤ì´ ì‚¬ë¼ì§€ê²Œ ë˜ê³ , ë˜ JWTì˜ í¬ê¸°ëŠ” ìƒëŒ€ì ìœ¼ë¡œ í¬ê¸° ë•Œë¬¸ì— ì¿ í‚¤ì— JWTë¥¼ ë‹´ì„ ê²½ìš° ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p>

<p>ê·¸ë˜ì„œ ì“°ë¼ëŠ” ê±°ì•¼ ë§ë¼ëŠ”ê±°ì•¼ ë¼ê³  ë¬¼ìœ¼ì‹ ë‹¤ë©´?
í•œë²ˆì¯¤ ì¨ ë³´ì ì§€ê¸ˆ ì•„ë‹ˆë©´ ì–¸ì œ ì¨ë³´ê² ëƒ ë¼ê³  ë‹µí•´ë“œë¦¬ê³  ì‹¶ë‹¤.
ì´ëŸ° ê°œì¸ ê°œë°œ í”„ë¡œì íŠ¸ì—ì„œë‚˜ ì¨ë³´ì§€ ì•„ë‹ˆë©´ ì–´ë–»ê²Œ ì“°ê² ì–´ìš” ã…ã…;</p>

<p>JWT ë˜í•œ, passport.jsì˜ JWT Strategyë¥¼ ì‚¬ìš©í•´ì„œ ê°œë°œí•˜ê³ , ì´ì „ì˜ ì½”ë“œë“¤ì—ì„œ ëª‡ê°€ì§€ê°€ ë” ì¶”ê°€ëœ í˜•íƒœë¡œ ê°œë°œëœë‹¤.</p>

<h2 id="using-jwt-strategy">Using JWT Strategy</h2>

<p>ì‹¤ ì½”ë“œì—ì„œ ì–´ë– í•œ ë°©í–¥ìœ¼ë¡œ ì½¬ë“œê°€ ì¶”ê°€ ë˜ì—ˆëŠ”ì§€ ì‚´í´ë³´ì</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jwt.strategy.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Strategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">passport-jwt</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PassportStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/passport</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">fromAuthCookie</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">let</span> <span class="nx">token</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">request</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">token</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">=</span><span class="dl">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
			<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">token</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">JwtStrategy</span> <span class="kd">extends</span> <span class="nx">PassportStrategy</span><span class="p">(</span><span class="nx">Strategy</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">({</span>
			<span class="na">jwtFromRequest</span><span class="p">:</span> <span class="nx">fromAuthCookie</span><span class="p">(),</span>
			<span class="na">ignoreExpiration</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="na">secretOrKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWTSECRET</span><span class="p">,</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="k">async</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">payload</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="p">{</span> <span class="na">userId</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">sub</span><span class="p">,</span> <span class="na">username</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">username</span> <span class="p">};</span>
	<span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p>ìš°ì„  jwt.strategy.tsíŒŒì¼ì´ë‹¤. 
ì´ ë¶€ë¶„ì—ì„œ ìš”ì²­ì—ì„œ ì¿ í‚¤ë¥¼ ë¶„ë¦¬í•´ì™€ì„œ jwtFromRequestë¡œ ë„£ì–´ì£¼ëŠ” fromAuthCookieë¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆê³ , ì´ë¥¼ í†µí•´ ë„£ì–´ì§„ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ë””ì½”ë”©ë˜ê³  validateì˜ payloadë¡œ ë³´ë‚´ì§€ê²Œ ëœë‹¤.
ê·¸ í›„ ê²€ì¦ì˜ ê³¼ì •ì„ ê±°ì¹˜ê³  userIdì™€ usernameì„ payloadì—ì„œ ë¶„ë¦¬í•´ì„œ ë¦¬í„´ì‹œì¼œì¤€ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// auth.controller.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Get</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">Post</span><span class="p">,</span> <span class="nx">Render</span><span class="p">,</span> <span class="nx">UseGuards</span><span class="p">,</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">Res</span><span class="p">,</span> <span class="nx">Redirect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthGuard</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/passport</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../service/auth.service</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">auth</span><span class="dl">"</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthController</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">authService</span><span class="p">:</span> <span class="nx">AuthService</span><span class="p">)</span> <span class="p">{}</span>

	<span class="p">@</span><span class="nd">UseGuards</span><span class="p">(</span><span class="nx">AuthGuard</span><span class="p">(</span><span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">))</span>
	<span class="p">@</span><span class="nd">Redirect</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
	<span class="p">@</span><span class="nd">Post</span><span class="p">()</span>
	<span class="k">async</span> <span class="nx">login</span><span class="p">(@</span><span class="nd">Request</span><span class="p">()</span> <span class="nx">req</span><span class="p">,</span> <span class="p">@</span><span class="nd">Res</span><span class="p">({</span> <span class="na">passthrough</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span> <span class="nx">response</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">authService</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">({</span>
			<span class="na">useranme</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
			<span class="na">sub</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">userpw</span><span class="p">,</span>
		<span class="p">});</span>

		<span class="nx">response</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="dl">"</span><span class="s2">Authorization</span><span class="dl">"</span><span class="p">,</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">access_token</span><span class="p">,</span> <span class="p">{</span>
			<span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="p">});</span>
		<span class="nx">response</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="dl">"</span><span class="s2">Refresh</span><span class="dl">"</span><span class="p">,</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">refresh_token</span><span class="p">,</span> <span class="p">{</span>
			<span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="p">});</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>
<p>ì²˜ìŒ ì‘ì„±í•˜ì˜€ë˜ local strategyë¥¼ í™œìš©í•œ ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ì„±ê³µí•˜ë©´ AuthServiceì˜ getAccessTokenìœ¼ë¡œ í† í°ì„ ìƒì„±í•˜ê³  response ê°ì²´ì— cookieë¥¼ ì£¼ì…í•´ì„œ ì „ì†¡ì‹œì¼œì¤€ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Mapper</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../mapper/mapper</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">queryString</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../common/query</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">JwtService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/jwt</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">executionResult</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">src/dto/user.dto</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthService</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span>
		<span class="k">private</span> <span class="k">readonly</span> <span class="nx">mapper</span><span class="p">:</span> <span class="nx">Mapper</span><span class="p">,</span>
		<span class="k">private</span> <span class="k">readonly</span> <span class="nx">jwtService</span><span class="p">:</span> <span class="nx">JwtService</span><span class="p">,</span>
	<span class="p">)</span> <span class="p">{}</span>

	<span class="k">async</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">userid</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">userpw</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="na">findOne</span><span class="p">:</span> <span class="nx">executionResult</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">mapper</span><span class="p">(</span>
			<span class="nx">queryString</span><span class="p">.</span><span class="nx">findOne</span><span class="p">,</span>
			<span class="p">[</span><span class="nx">userid</span><span class="p">],</span>
		<span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span>
			<span class="nx">findOne</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
			<span class="nx">findOne</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">]</span> <span class="o">===</span> <span class="nx">userpw</span>
		<span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">findOne</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">async</span> <span class="nx">getAccessToken</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span> <span class="na">useranme</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="na">sub</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">userId</span> <span class="p">};</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="na">access_token</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">jwtService</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span>
				<span class="na">secret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWTSECRET</span><span class="p">,</span>
				<span class="na">expiresIn</span><span class="p">:</span> <span class="dl">"</span><span class="s2">5m</span><span class="dl">"</span><span class="p">,</span>
			<span class="p">}),</span>
			<span class="na">refresh_token</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">jwtService</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span>
				<span class="na">secret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWTSECRET</span><span class="p">,</span>
				<span class="na">expiresIn</span><span class="p">:</span> <span class="dl">"</span><span class="s2">7d</span><span class="dl">"</span><span class="p">,</span>
			<span class="p">}),</span>
		<span class="p">};</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>getAccessToken í•¨ìˆ˜ì˜ í˜•íƒœë¥¼ ë³´ë©´, jwtServiceì˜ signí•¨ìˆ˜ë¥¼ í†µí•´ì„œ í† í°ì„ ìƒì„±ì‹œì¼œì£¼ê³ , í”„ë¡ íŠ¸ì—ì„œ í•„ìš”í•˜ëŠ” accessTokenê³¼ refreshToken 2ê°œë¥¼ ë§Œë“¤ì–´ì„œ í´ë¼ì´ì–¸íŠ¸ì¸¡ì— ì „ë‹¬í•´ì¤€ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../controller/auth.controller</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../service/auth.service</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Mapper</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../mapper/mapper</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LocalStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../strategy/local.strategy</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PassportModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/passport</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UserServcie</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">src/service/user.service</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">JwtModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/jwt</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">JwtStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">src/strategy/jwt.strategy</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
	<span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
		<span class="nx">PassportModule</span><span class="p">,</span>
		<span class="nx">JwtModule</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
			<span class="na">secret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWTSECRET</span><span class="p">,</span>
			<span class="na">signOptions</span><span class="p">:</span> <span class="p">{</span> <span class="na">expiresIn</span><span class="p">:</span> <span class="dl">"</span><span class="s2">5m</span><span class="dl">"</span> <span class="p">},</span>
		<span class="p">}),</span>
	<span class="p">],</span>
	<span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AuthController</span><span class="p">],</span>
	<span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AuthService</span><span class="p">,</span> <span class="nx">UserServcie</span><span class="p">,</span> <span class="nx">Mapper</span><span class="p">,</span> <span class="nx">LocalStrategy</span><span class="p">,</span> <span class="nx">JwtStrategy</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthModule</span> <span class="p">{}</span>


</code></pre></div></div>

<p>jwtë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ëª¨ë“ˆì— ë“±ë¡í•´ì£¼ëŠ” ì‘ì—…ì´ë‹¤.
ì—¬ê¸°ì„œ ì‚¬ì¸í•˜ëŠ”ë° í•„ìš”í•œ secret í‚¤ëŠ” .envíŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©í•œë‹¤.
ì´ ê°’ì€ ì™¸ë¶€ë¡œ ìœ ì¶œë˜ê±°ë‚˜, ê¹ƒ ë“±ì— ì˜¬ë ¤ì„œëŠ” ì•ˆë˜ëŠ” íŒŒì¼ì´ë‹¤.</p>

<p>ìœ ì˜!!!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Get</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">Post</span><span class="p">,</span> <span class="nx">Body</span><span class="p">,</span> <span class="nx">Param</span><span class="p">,</span> <span class="nx">Patch</span><span class="p">,</span> <span class="nx">UseGuards</span><span class="p">,</span> <span class="nx">UseFilters</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UserServcie</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../service/user.service</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">executionResult</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../dto/user.dto</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createUserDTO</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../dto/createUser.dto</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthGuard</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/passport</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ViewAuthFilter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">src/filter/ViewAuth.Filter</span><span class="dl">"</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserController</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">userService</span><span class="p">:</span> <span class="nx">UserServcie</span><span class="p">)</span> <span class="p">{}</span>

	<span class="p">@</span><span class="nd">UseGuards</span><span class="p">(</span><span class="nx">AuthGuard</span><span class="p">(</span><span class="dl">"</span><span class="s2">jwt</span><span class="dl">"</span><span class="p">))</span>
	<span class="p">@</span><span class="nd">UseFilters</span><span class="p">(</span><span class="nx">ViewAuthFilter</span><span class="p">)</span>
	<span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">)</span>
	<span class="k">async</span> <span class="nx">getUser</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">executionResult</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getUser</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
		<span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getUser</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="p">@</span><span class="nd">Post</span><span class="p">()</span>
	<span class="k">async</span> <span class="nx">createUser</span><span class="p">(@</span><span class="nd">Body</span><span class="p">()</span> <span class="nx">user</span><span class="p">:</span> <span class="nx">createUserDTO</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">executionResult</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">createUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="p">@</span><span class="nd">UseGuards</span><span class="p">(</span><span class="nx">AuthGuard</span><span class="p">(</span><span class="dl">"</span><span class="s2">jwt</span><span class="dl">"</span><span class="p">))</span>
	<span class="p">@</span><span class="nd">UseFilters</span><span class="p">(</span><span class="nx">ViewAuthFilter</span><span class="p">)</span>
	<span class="p">@</span><span class="nd">Patch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">)</span>
	<span class="k">async</span> <span class="nx">patchUser</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">)</span> <span class="nx">user</span><span class="p">:</span> <span class="nx">createUserDTO</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">executionResult</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

		<span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">createUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ì‹¤ì œë¡œ jwtì¸ì¦ì´ ì‚¬ìš©ë˜ëŠ” ì½”ë“œ ë¶€ë¶„ì´ë‹¤.
jwt í† í°ìœ¼ë¡œ ì¸ì¦ëœ ê²½ìš°ì—ë§Œ ì´í•˜ì˜ ì½”ë“œë“¤ì´ ì‘ë™í•˜ê²Œ ëœë‹¤.</p>

<h3 id="ê²°ë¡ ">ê²°ë¡ </h3>

<p>jwtëŠ” ìƒë‹¹íˆ í’€ì–´ì ¸ìˆê³  ëŠìŠ¨í•œ í˜•íƒœì˜ í‘œì¤€ì´ë¼ëŠ” ìƒê°ì´ ë“ ë‹¤. ê°œë°œìê°€ í•„ìš”í•œ ì •ë³´ë¥¼ payloadì•ˆì— ë„£ì„ ìˆ˜ ìˆê³ , ê°œë°œí•˜ê¸° í¸ë¦¬í•œ í˜•íƒœë¡œ ë°œì „í•  ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ë„ ë“ ë‹¤.</p>

<p>í•˜ì§€ë§Œ ê·¸ëŸ¬í•œ ì ì€ ì¥ì ìœ¼ë¡œ ë‹¤ê°€ì˜¤ê¸°ë„ í•˜ì§€ë§Œ, ìš•ì‹¬ì´ ê³¼í•´ì§€ë©´ í† í°ì´ ë¬´ê±°ì›Œì§€ê³  ì„¸ì…˜ê³¼ ì¿ í‚¤ë¡œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ë³´ë‹¤ ì˜¤íˆë ¤ í¼í¬ë¨¼ìŠ¤ë‚˜ ì‚¬ìš©ì í¸ë¦¬ì„±ì„ í•´ì¹  ìˆ˜ ìˆê² ë‹¤ëŠ” ìƒê°ë˜í•œ ë“¤ê²Œ ëœë‹¤.</p>

<p>ë˜ ê°€ì¥ í° ë¬¸ì œì ìœ¼ë¡œ ê¼½ëŠ” ê²ƒ ì¤‘ í•˜ë‚˜ê°€, ì„¸ì…˜ìœ¼ë¡œë„ ì¶©ë¶„í•œ ê·œëª¨ì˜ ì‚¬ì´íŠ¸ì¸ë° ê´œí•œ ì™€! ìƒˆë¡œìš´ ê¸°ìˆ ! ì´ë¼ëŠ” í™˜ìƒìœ¼ë¡œ ì°¨ì„ ìœ¼ë¡œ ì¶©ë¶„í•œ jwtê°€ ìµœì„ ì´ ë˜ëŠ” ê²½ìš°ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.
í•„ìš”í•œ ê²½ìš°ì—ë§Œ, ì˜ í™œìš©í•˜ì</p>
:ET