---
layout: post
title: "REST api URL 디자인"
subtitle: "패턴화 가이드라인들"
date: 2021-08-22 12:30:15 +0900
background: '/img/posts/05.jpg'
---


## 자주 언급되는 가이드들


### URL에 동사나 행동을 표현하지 않고, 명사만을 사용한다
URL은 리소스가 어디에 위치할 수 있고, 어떤 행동들이 수행될 수 있는지 나타내는 경로이다. 그렇기 때문에 동사 등으로 행동을 표현하기 보다, method를 통하여 표현하는 것이 올바르다.

예를 들어,
``` 
Get   /adduser
GET   /postuser
GET   /deleteuser
GET   /updateuser
```
보단,
```
GET     /user
POST    /user
DELETE  /user
PUT     /user
```
가 훨신 더 보기 좋다. 이러한 점에 있어서 아래의 URL과 메소드를 통하여 일관적이고 정확한 행위를 표현할 수 있게 된다.


### HTTP methods를 사용한다
위에서 언급한 내용과 일맥상통하는 내용이다. URL에서 행동을 설명하기 위한 단어들을 제거했을때, 그 행동은 HTTP methods를 통해서 설명하게 된다. 현재 명세에서 제공하고 있는 methods는 9가지가 있는데, 각 methods들에 대한 설명은 MDN의 글[링크](https://developer.mozilla.org/ko/docs/Web/HTTP/Methods)를 통해서 더 알아보면 좋을 것 같다. 

1. GET
2. HEAD
3. POST
4. PUT
5. DELETE
6. CONNECT
7. OPTIONS
8. TRACE
9. PATCH

이 9가지의 Methods 중 자주 자용하는 것은 GET, POST, PUT, DELETE 일 것이다. 이 methods를 sql과 연관을 지어 보자면 select, insert, update, delete 정도로 설명할 수 있을 것이다. 

위의 예제를 조금 더 설명을 덧붙이자면, 다음과 같겠다
```
GET     /user                * user들을 조회
GET     /user/34             * user (id: 34)를 조회
POST    /user                * 새로운 user 생성
DELETE  /user                * 기존 user 전체 삭제
DELETE  /user/34             * 기존 user 특정 유저(34) 삭제
PUT     /user/34             * 기존 user 특정 유저(34) 업데이트
```
URL이 자원에 대한 경로를 의미하는 것이니까, /user라는 폴더를 가지고 생각하는 것 또한 편할 것이다. user라는 디렉토리가 있고, 그 하위에 user의 id가 디렉토리 명이 되어서 폴더들이 쭉 나열되어 있다. 그러한 폴더들에 대한 행동을 methods로 표현하게 된다.

### HTTP 응답 상태 코드를 사용한다
클라이언트에서 api 서버측에 요청을 보내고, 그 응답으로 요청이 성공적으로 실행되었다면 그 응답과, 필요시에 데이터를 첨부해서 보내야 할 것이고 그렇지 않을 경우에 에러를 반환하여야 클라이언트 측에서 내 요청이 정상적으로 실행 되었는지, 혹은 실행이 되었긴 했는데 어떻게 처리가 되는건지, 되고 있는건지 알 수 있을 것이다. 이러한 점을 알려주기 위해서 HTTP에서 미리 정해놓은 응답 상태 코드를 가지고 응답해 주는것이 좋다.

HTTP 응답 상태 코드에는 수십가지가 있고, 자주 쓰는 것만 뽑자면
1. 200: OK, 요청을 성공적으로 수행
2. 400: Bad request, 클라이언트의 요청사항을 서버가 이해하지 못하여 정상적으로 수행 불가
3. 404: Not Found, 요청 리소스 사용 불가
4. 500: Internal Server Error, 요청은 유효하지만, 서버 내 문제로 오류 발생
5. 503: Service Unavaiable, 서버 다운 등의 이유로 request 처리 불가 상태
정도가 있지 않을까 생각이 든다.

적절한 응답 코드와 함께 성공적으로 수행시 데이터 반환이 필요한 경후 첨부하여 응답하면 될 것이다.
더 많은 응답 상태 코드들에 대해서 알아보고 싶다면, MDN의 글[링크](https://developer.mozilla.org/ko/docs/Web/HTTP/Status)를 통하여 알아보면 좋을 것이다.


### 네이밍 컨벤션
하나의 네이밍 컨벤션을 사용하기로 했다면, 전체적으로 일관성을 가지도록 하는것이 중요하다. 카멜케이스와 스네이크 케이스와 케밥케이스를 섞어서 자용하는 것 보다는, 하나의 컨벤션으로 통일하는것이 일관적이고 나중에 보기에 편리하다.

### 검색, 정렬, 필터링, 페이지네이션
GET을 통해서 데이터를 조회할 때, 검색이나 소팅, 필터링, 페이지네이션을 위한 methods는 제공되지 않는다. 이러한 경우를 지원하기 위해서 query parameter를 통해 행동을 처리할 수 있게 된다.

```
GET    /user?search=34
GET    /user?sorting=asc
GET    /user?member-type=admin
GET    /user?page=3
```
위의 예제를 볼 때, 전체 유저들을 대상으로 검색하고, 오름차순으로 정렬하여 반환하고, 필터링하고, 페이지로 나누어 특정 페이지만을 조회하는 URL에 대해서 간략하게 나타내고 있다. 이러한 query paramter를 지원하기 위해서는 추가적인 기능 개발이 필요하지만, 클라이언트가 필요로 하는 정보를 검색하고 나타내는데 많은 도움을 줄 수 있을 것이다.


### 버저닝
개발하고 있는 api가 특정 버전을 기점으로 사양 변경이 이루어질 경우, 버전 표시를 통해서 이전 버전과의 차이점을 두고 명시를 할 수 있을 것이다
```
GET http://api.my.site/v1/user
GET http://api.my.site/v2/user?member-type=admin
```
예를 들어 초기 버전에서 지원하지 않던 필터 등이 버전 2에서 지원된다거나, 응답 json의 형식이 버전 2에서 달라지거나 하는 등의 변경이 있을때 버저닝을 통해서 알리는 것이 좋아 보인다.


### 캐싱
모든 데이터를 데이터베이스에서 불러오는 것은 처리 성능과 데이터베이스 서버에 많은 영향을 끼칠 수 있다. 이러한 것을 사전에 방지하고 성능 향상을 위해서 캐싱을 하는 것이 권장된다.
node.js의 express 경우에는 apicache라는 미들웨어가 존재하고 많은 설정 없이도 메모리 캐싱을 할 수 있다.
하지만 처리량이 많아짐에 따라 분산 처리 등을 고려했을때 메모리 케싱에 대해서 고민해야 할 부분들 또한 많아지게 된다.


### 보안
